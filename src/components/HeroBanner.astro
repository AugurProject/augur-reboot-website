---
import AugurLogo from '../assets/augur.svg';
import DiscordLogo from '../assets/discord.svg';
import XLogo from '../assets/x.svg';
import GithubLogo from '../assets/github.svg';
---

<div class="fixed inset-0 h-screen w-screen overflow-scroll place-content-center">
  <div id="hero-banner-container" class="flex flex-col justify-center items-center text-primary font-barlow z-10 text-center min-h-[500px] overflow-y-scroll">
    <div id="social-links" class="absolute top-8 right-10 flex gap-x-8">
      <a id="twitter-link" href="https://x.com/AugurProject" class="text-primary hover:text-foreground focus:text-foreground no-underline font-console text-3xl">
        <XLogo />
      </a>
      <a id="discord-link" href="https://discord.gg/Y3tCZsSmz3" class="text-primary hover:text-foreground focus:text-foreground no-underline font-console text-3xl">
        <DiscordLogo />
      </a>
      <a id="github-link" href="https://github.com/AugurProject/" class="text-primary hover:text-foreground focus:text-foreground no-underline font-console text-3xl">
        <GithubLogo />
      </a>
    </div>

    <AugurLogo id="augur-logo" class:list="text-9xl" />
    
    <p id="prediction-market-text" class="font-barlow border border-primary/30 px-3 py-1 text-lg my-5 tracking-[0.22em] leading-tight text-foreground">
      THE FRONTIER OF PREDICTION MARKET
    </p>

    <h2 class="text-[2.5em] flex items-center gap-5 title">
      <span id="line-left" class="w-[50px] h-[1px] bg-foreground"></span>
      <span id="is-rebooting-text" class="title font-console text-3xl md:text-[2.5rem]">IS REBOOTING</span>
      <span id="line-right" class="w-[50px] h-[1px] bg-foreground"></span>
    </h2>

    <div id="menu-items-container" class="flex flex-col place-items-center font-console mt-12 text-left w-full max-w-3xl mx-auto">
      <a id="first-menu-item" href="/mission" class="text-base py-1 block hover:text-foreground focus:text-foreground focus:outline-none">
        REIMAGINED, TRANSFORMED, REFRESHED
      </a>
      <a href="#" class="text-base py-1 block hover:text-foreground focus:text-foreground focus:outline-none">
        THE VISIONARIES BEHIND AUGUR
      </a>
      <a href="#" class="text-base py-1 block hover:text-foreground focus:text-foreground focus:outline-none">
        IS MY REP SAFE?
      </a>
    </div>
  </div>
</div>

<style>
  /* --- Keyframe Definitions --- */
  @keyframes fade-in-up {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fade-in-down {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes logo-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes logo-scale-down {
    from { transform: scale(2) translateY(50%); }
    to { transform: scale(1) translateY(0); }
  }

  @keyframes scale-in {
    from { opacity: 0; transform: scale(0.5); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes slide-in-from-right {
    from { opacity: 0; transform: translateX(25px); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes slide-in-from-left {
    from { opacity: 0; transform: translateX(-25px); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes bounce-horizontal {
    0%, 100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(-8px);
    }
  }

  /* --- Initial Animation States --- */
  #discord-link,
  #twitter-link,
  #github-link,
  #is-rebooting-text,
  #line-left,
  #line-right,
  #prediction-market-text,
  #menu-items-container a {
    opacity: 0;
  }

  #augur-logo {
    opacity: 0;
    transform: scale(2) translateY(50%);
  }

  /* --- Menu Pointer (Semantic & Nested) --- */
  #menu-items-container a {
    position: relative; /* Needed for pseudo-element positioning */

    &::before {
      content: '>';
      opacity: 0;
      color: var(--color-foreground);
      display: inline-block;
      margin-right: 0.5rem;
      transition: opacity 0.2s ease-in-out;
    }

    /* Default hover and focus behavior */
    &:hover, &:focus {
      color: var(--color-foreground);
      &::before {
        opacity: 1;
        animation: bounce-horizontal 1s ease-in-out infinite;
      }
    }
  }

  /* --- Hover Priority (:has) --- */
  /* When a link is being hovered inside the container... */
  #menu-items-container:has(a:hover) {
    /* ...target the link that is focused but NOT hovered. */
    & a:focus:not(:hover) {
      /* Revert its text color */
      color: var(--color-primary);
      /* Hide its pointer */
      &::before {
        opacity: 0;
        animation: none;
      }
    }
  }

  /* --- Animation Skip State --- */
  #hero-banner-container.animations-skipped #augur-logo {
    opacity: 1;
    transform: scale(1) translateY(0);
  }

  #hero-banner-container.animations-skipped #discord-link,
  #hero-banner-container.animations-skipped #twitter-link,
  #hero-banner-container.animations-skipped #github-link,
  #hero-banner-container.animations-skipped #is-rebooting-text,
  #hero-banner-container.animations-skipped #line-left,
  #hero-banner-container.animations-skipped #line-right,
  #hero-banner-container.animations-skipped #prediction-market-text,
  #hero-banner-container.animations-skipped #menu-items-container a {
    opacity: 1;
    transform: none; /* Resets any initial transform */
  }

  /* --- Animation Trigger --- */
  #hero-banner-container.animations-started #twitter-link {
    animation: fade-in-down 0.5s ease-out 7.5s forwards;
  }

  #hero-banner-container.animations-started #discord-link {
    animation: fade-in-down 0.5s ease-out 7.7s forwards;
  }

  #hero-banner-container.animations-started #github-link {
    animation: fade-in-down 0.5s ease-out 7.9s forwards;
  }

  #hero-banner-container.animations-started #augur-logo {
    animation: 
      logo-fade-in 0.5s ease-in 2s forwards,
      logo-scale-down 1s ease-out 4s forwards;
  }

  #hero-banner-container.animations-started #prediction-market-text {
    animation: fade-in-up 0.8s ease-out 5.2s forwards;
  }

  #hero-banner-container.animations-started #line-left {
    animation: slide-in-from-right 0.25s ease-out 6.2s forwards;
  }
  #hero-banner-container.animations-started #line-right {
    animation: slide-in-from-left 0.25s ease-out 6.2s forwards;
  }

  #hero-banner-container.animations-started #is-rebooting-text {
    animation: scale-in 0.4s ease-in 6.5s forwards;
  }

  #hero-banner-container.animations-started #menu-items-container a:nth-of-type(1) {
    animation: fade-in-up 0.5s ease-out 7.3s forwards;
  }
  #hero-banner-container.animations-started #menu-items-container a:nth-of-type(2) {
    animation: fade-in-up 0.5s ease-out 7.5s forwards;
  }
  #hero-banner-container.animations-started #menu-items-container a:nth-of-type(3) {
    animation: fade-in-up 0.5s ease-out 7.7s forwards;
  }
</style>

<script>
  const heroBanner = document.getElementById('hero-banner-container');
  const firstMenuItem = document.getElementById('first-menu-item') as HTMLAnchorElement | null;
  const urlParams = new URLSearchParams(window.location.search);
  const skipIntro = urlParams.get('intro') === 'false';

  if (skipIntro) {
    heroBanner?.classList.add('animations-skipped');
    firstMenuItem?.focus();
  } else {
    document.addEventListener('introFinished', () => {
      if (heroBanner) {
        heroBanner.classList.add('animations-started');
        setTimeout(() => {
          firstMenuItem?.focus();
        }, 8300);
      }
    });
  }

  // Force show elements when navigating back with skip intro
  function forceShowElements() {
    const newParams = new URLSearchParams(window.location.search);
    if (newParams.get('intro') === 'false') {
      if (heroBanner) {
        heroBanner.classList.remove('animations-started');
        heroBanner.classList.add('animations-skipped');
        firstMenuItem?.focus();
      }
    }
  }

  // Try multiple events to catch view transitions
  document.addEventListener('astro:page-load', forceShowElements);
  document.addEventListener('astro:after-swap', forceShowElements);
</script>

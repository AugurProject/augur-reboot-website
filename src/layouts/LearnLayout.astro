---
import Layout from "../layouts/Layout.astro";
import SocialLinks from "../components/SocialLinks.astro";
import Footer from "../components/Footer.astro";
import LearnNavigation from "../components/LearnNavigation.tsx";
import Button from "../components/Button.tsx";
import Pointer from "../components/Pointer.tsx";
import PageHeading from "../components/PageHeading.astro";
import { withBase } from "../lib/utils";

interface Props {
	title: string
	description?: string
}

const { title, description } = Astro.props

// Topic navigation data
const topics = [
	{ title: 'WHAT IS A FORK?', slug: '/learn/fork', path: '/learn/fork' },
	{
		title: 'FORK TRIGGER MECHANICS',
		slug: '/learn/fork/trigger',
		path: '/learn/fork/trigger',
	},
	{ title: 'DISPUTE PROCESS', slug: '/learn/fork/bonds', path: '/learn/fork/bonds' },
	{
		title: 'RISK CALCULATION',
		slug: '/learn/fork/calculation',
		path: '/learn/fork/calculation',
	},
	{ title: 'WHAT TO DO', slug: '/learn/fork/what-to-do', path: '/learn/fork/what-to-do' },
	{
		title: 'RISK MITIGATION',
		slug: '/learn/fork/mitigation',
		path: '/learn/fork/mitigation',
	},
]

const currentPath = Astro.url.pathname
---

<Layout
	title={`${title} - Augur Fork Mechanics`}
	description={description || "Learn about Augur protocol forks and fork mechanics"}
	ogType="article"
>
	<div class="grid grid-rows-[auto_1fr_auto] min-h-screen uppercase">
		{/* Top Section: Navigation */}
		<div class="flex justify-between items-start p-8">
			{/* Back Button */}
			<Button id="back-button" variant="link" href={withBase('/?intro=false')} autofocus>
				<Pointer direction="left" animated="auto" />
				BACK TO HOME
			</Button>

			{/* Social Links */}
			<SocialLinks />
		</div>

		{/* Middle Section: Scrollable Content */}
		<main class="overflow-y-auto px-4 md:px-8 mb-12">
			<div class="max-w-2xl mx-auto">
				<PageHeading text={title} />

				{/* Main Content */}
				<article class="prose prose-invert max-w-none">
					<slot />
				</article>
			</div>
		</main>

		{/* Bottom Section: Sticky Navigation + Footer */}
		<LearnNavigation client:load currentPath={currentPath} currentTitle={title} topics={topics} />
		<Footer />
	</div>

	<style is:global>
		/* Custom prose styles for dark mode - Tailwind v4 CSS-first approach */
		.prose {
			--tw-prose-headings: var(--color-primary);
			--tw-prose-links: var(--color-primary);
			--tw-prose-body: var(--color-foreground);
			--tw-prose-bold: var(--color-foreground);
			--tw-prose-code: var(--color-green-400);
			--tw-prose-borders: var(--color-primary);
			--tw-prose-bg-hover: var(--color-primary);
		}

		.prose h1 {
			font-size: 2rem;
			font-weight: 300;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			margin-bottom: 1rem;
			color: var(--color-primary);
		}

		.prose h2 {
			font-size: 1.5rem;
			font-weight: 300;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			margin-top: 2rem;
			margin-bottom: 1rem;
			color: var(--color-primary);
		}

		.prose h3 {
			font-size: 1.25rem;
			font-weight: 300;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			margin-top: 1.5rem;
			margin-bottom: 0.75rem;
			color: var(--color-primary);
		}

		.prose p {
			line-height: 1.6;
			margin-bottom: 1rem;
			font-weight: 300;
			color: var(--color-foreground);
		}

		.prose a {
			color: var(--color-primary);
			text-decoration: none;
			transition: color 0.2s;
		}

		.prose a:hover {
			color: var(--color-primary);
			opacity: 0.8;
		}

		.prose code {
			background-color: rgba(42, 231, 168, 0.1);
			padding: 0.25rem 0.5rem;
			border-radius: 0.25rem;
			font-size: 0.875rem;
			font-family: monospace;
			color: var(--color-green-400);
		}

		.prose li {
			margin-bottom: 0.5rem;
			font-size: 1rem;
			font-weight: 300;
			color: var(--color-foreground);
		}

		.prose ul,
		.prose ol {
			margin-bottom: 1rem;
			padding-left: 1.5rem;
		}

		.prose blockquote {
			border-left: 2px solid rgba(42, 231, 168, 0.4);
			padding-left: 1rem;
			font-style: italic;
			color: var(--color-green-800);
			padding-top: 0.5rem;
			padding-bottom: 0.5rem;
		}

		.prose table {
			margin-bottom: 1rem;
			width: 100%;
			border-collapse: collapse;
		}

		.prose table th {
			border-bottom: 1px solid rgba(42, 231, 168, 0.3);
			padding: 0.5rem;
			text-align: left;
			font-weight: 400;
			color: var(--color-primary);
		}

		.prose table td {
			border-bottom: 1px solid rgba(42, 231, 168, 0.15);
			padding: 0.5rem;
			color: var(--color-foreground);
		}
	</style>
</Layout>

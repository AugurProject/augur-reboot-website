---
import { getCollection } from 'astro:content';
import ArcLayout from '../../layouts/ArcLayout.astro';

export const prerender = true;

interface Props {
  entry: any;
  prevPost?: { title: string; path: string };
  nextPost?: { title: string; path: string };
}

export async function getStaticPaths() {
  const arcPosts = await getCollection('arc');

  // Sort posts by publish date (oldest first for navigation purposes)
  const sortedPosts = arcPosts.sort(
    (a, b) => a.data.publishDate.valueOf() - b.data.publishDate.valueOf()
  );

  return sortedPosts.map((entry, index) => {
    const slug = entry.slug;

    // Get previous and next posts for navigation
    const prevPost = index > 0 ? {
      title: sortedPosts[index - 1].data.title,
      path: `/arc/${sortedPosts[index - 1].slug}`
    } : undefined;

    const nextPost = index < sortedPosts.length - 1 ? {
      title: sortedPosts[index + 1].data.title,
      path: `/arc/${sortedPosts[index + 1].slug}`
    } : undefined;

    return {
      params: { slug },
      props: { entry, prevPost, nextPost },
    };
  });
}

const { entry, prevPost, nextPost } = Astro.props;
const { Content } = await entry.render();
const { title, description, author, publishDate, updatedDate, tags } = entry.data;
---

<ArcLayout
  title={title}
  description={description}
  author={author}
  publishDate={publishDate}
  updatedDate={updatedDate}
  tags={tags}
  prevPost={prevPost}
  nextPost={nextPost}
>
  <Content />
</ArcLayout>

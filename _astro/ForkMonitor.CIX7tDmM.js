import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";import{c as w}from"./utils.CBfrqCZ4.js";import{r as F}from"./index.Bv2DO4vj.js";import{$ as D,U as N}from"./animationStore.DYtN9AJJ.js";function M(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const y=s.createContext(void 0),_=({children:t,updateInterval:x=5*60*1e3})=>{const[o]=s.useState(()=>({timestamp:new Date().toISOString(),blockNumber:0,riskLevel:"unknown",riskPercentage:0,metrics:{largestDisputeBond:0,forkThresholdPercent:0,activeDisputes:0,disputeDetails:[]},nextUpdate:new Date(Date.now()+36e5).toISOString(),calculation:{method:"Static fallback",forkThreshold:275e3}})),[a,i]=s.useState(null),[r,l]=s.useState(!1),[c,u]=s.useState(),[p,d]=s.useState(!1),m=s.useCallback(async()=>{try{l(!0),u(void 0);const n="/",g=n.endsWith("/")?`${n}data/fork-risk.json`:`${n}/data/fork-risk.json`,b=await fetch(g);if(!b.ok)throw new Error(`Failed to load fork risk data: ${b.status}`);const R=await b.json();i(R)}catch(n){console.error("Error loading fork risk data:",n),u(n instanceof Error?n.message:"Failed to load data"),i(o)}finally{l(!1)}},[o]);s.useEffect(()=>{d(!0)},[]),s.useEffect(()=>{if(p){m();const n=setInterval(m,x);return()=>clearInterval(n)}},[m,x,p,o]);const f=n=>({percentage:n.riskPercentage,repStaked:n.metrics.largestDisputeBond,activeDisputes:n.metrics.activeDisputes}),h=n=>{let g;switch(n.riskLevel){case"low":g="Low";break;case"moderate":g="Medium";break;case"high":g="High";break;case"critical":g="Critical";break;default:g="Low"}return{level:g}},L=n=>{try{return new Date(n.timestamp).toLocaleString()}catch{return"Unknown"}},v=a||o,E=s.useCallback(n=>{i(n)},[]),C={gaugeData:f(v),riskLevel:h(v),lastUpdated:L(v),isLoading:r,error:c||v.error,rawData:v,setData:E,refetch:m};return e.jsx(y.Provider,{value:C,children:t})},j=()=>{const t=s.useContext(y);if(!t)throw new Error("useForkData must be used within a ForkDataProvider");return t};var k=(t=>(t.NO_DISPUTES="no_disputes",t.LOW_RISK="low_risk",t.MODERATE_RISK="moderate_risk",t.HIGH_RISK="high_risk",t.CRITICAL_RISK="critical_risk",t))(k||{});const I=s.createContext(void 0),U=({children:t})=>{const[x,o]=s.useState(!1),{setData:a}=j(),i=!1,r=s.useCallback(d=>{},[a,i]),l=s.useCallback(d=>{},[a,i]),c=s.useCallback(d=>{},[a,i]),u=s.useCallback(async()=>{try{const d="/",m=d.endsWith("/")?`${d}data/fork-risk.json`:`${d}/data/fork-risk.json`,f=await fetch(m);if(!f.ok)throw new Error(`Failed to load live data: ${f.status}`);const h=await f.json();a(h),o(!1)}catch(d){console.error("Error loading live fork risk data:",d),o(!1)}},[a]),p={isDemo:x,isDemoAvailable:i,generateRisk:r,generateScenario:l,setDemoData:c,resetToLive:u};return e.jsx(I.Provider,{value:p,children:t})},O=()=>{const t=s.useContext(I);if(!t)throw new Error("useForkMock must be used within a ForkMockProvider");return t},A=({percentage:t})=>{const x=r=>r===0?3:r<=10?3+r/10*22:r<=25?25+(r-10)/15*25:r<=75?50+(r-25)/50*40:Math.min(100,90+(r-75)/25*10),o=r=>{const l=x(r),c=Math.PI-l/100*Math.PI,u=200,p=200,d=120,m=u+d*Math.cos(c),f=p-d*Math.sin(c);return`M 80 200 A 120 120 0 0 1 ${m} ${f}`},a=r=>r===0?"STABLE":r<10?"LOW":r<25?"MODERATE":r<75?"HIGH":"CRITICAL",i=r=>r<10?"var(--color-green-400)":r<25?"var(--color-yellow-400)":r<75?"var(--color-orange-400)":"var(--color-red-500)";return e.jsxs("div",{className:w("relative mb-2 flex flex-col items-center"),children:[e.jsxs("svg",{className:"max-w-[180px] w-full",viewBox:"60 60 280 160",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"forkMeterGradient",x1:"80",y1:"200",x2:"320",y2:"200",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"var(--color-green-400)"}}),e.jsx("stop",{offset:"35%",style:{stopColor:"var(--color-green-500)"}}),e.jsx("stop",{offset:"55%",style:{stopColor:"var(--color-yellow-400)"}}),e.jsx("stop",{offset:"80%",style:{stopColor:"var(--color-orange-400)"}}),e.jsx("stop",{offset:"100%",style:{stopColor:"var(--color-red-500)"}})]})}),e.jsx("path",{d:"M 80 200 A 120 120 0 0 1 320 200",fill:"none",stroke:"var(--color-green-800)",strokeWidth:"12",strokeLinecap:"round",opacity:"0.3"}),e.jsx("path",{d:o(t),fill:"none",stroke:"url(#forkMeterGradient)",strokeWidth:"12",strokeLinecap:"round",className:"fx-glow"}),e.jsx("text",{x:"200",y:"195",textAnchor:"middle",fill:i(t),fontSize:"2.5rem",fontWeight:"bold",className:w("fx-glow-sm",`fx-glow-[${i(t)}]`),children:a(t)})]}),e.jsx("div",{className:"text-sm uppercase tracking-[0.5em] font-light text-muted-foreground",children:"FORK PRESSURE"})]})},K=({riskLevel:t,repStaked:x,activeDisputes:o})=>{const{rawData:a}=j(),i=c=>c.toLocaleString(),r=a.metrics.largestDisputeBond===0,l=a.metrics.disputeDetails?.length>0?a.metrics.disputeDetails.reduce((c,u)=>u.disputeBondSize>c.disputeBondSize?u:c):null;return e.jsx("div",{className:"w-full mb-1",children:r?e.jsx("div",{className:"uppercase font-light text-green-400 tracking-[0.1em] fx-glow",children:"System steady - No market disputes"}):e.jsxs("div",{className:"grid md:grid-cols-[8rem_8rem_8rem] md:place-content-center md:gap-y-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"FORK RISK"}),e.jsxs("div",{className:"uppercase font-light text-primary tracking-[0.1em] fx-glow",children:[a.metrics.forkThresholdPercent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"text-center md:border-x md:border-muted-foreground/40",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"DISPUTE BOND"}),e.jsxs("div",{className:"uppercase font-light text-primary tracking-[0.1em] fx-glow",children:[i(a.metrics.largestDisputeBond)," REP"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"DISPUTE ROUND"}),e.jsx("div",{className:"uppercase font-light text-primary tracking-[0.1em] fx-glow",children:l?.disputeRound||1})]}),l&&e.jsxs("div",{className:"text-center md:col-span-full",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"MARKET IN DISPUTE"}),e.jsx("div",{className:"uppercase font-light text-primary tracking-[0.1em] truncate mx-auto fx-glow",style:{maxWidth:"calc(100vw - 2rem)"},children:l.marketId})]})]})})};var T=F();const S=M(T),V=()=>{const{isDemo:t,isDemoAvailable:x,generateScenario:o,resetToLive:a}=O(),[i,r]=s.useState(!1);return x?(s.useEffect(()=>{const l=c=>{c.key==="F2"&&(c.preventDefault(),r(u=>!u))};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[]),i?S.createPortal(e.jsxs("div",{className:"fixed top-4 left-4 z-50 bg-background/95 border border-primary/30 p-4 rounded text-sm max-w-xs",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-primary font-bold",children:"Demo Controls"}),e.jsx("button",{onClick:()=>r(!1),className:"text-muted-foreground hover:text-primary",children:"Ã—"})]}),t&&e.jsxs("div",{className:"mb-3 p-2 bg-orange-900/20 border border-orange-500/30 rounded",children:[e.jsx("div",{className:"text-orange-400 text-xs font-bold mb-1",children:"DEMO MODE ACTIVE"}),e.jsx("button",{onClick:a,className:"text-xs bg-primary/20 hover:bg-primary/30 px-2 py-1 rounded",children:"Return to Live Data"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Generate Scenarios:"}),e.jsx("button",{onClick:()=>o(k.NO_DISPUTES),className:"block w-full text-left text-xs bg-green-900/20 hover:bg-green-900/30 px-2 py-1 rounded",children:"No Disputes (Steady)"}),e.jsx("button",{onClick:()=>o(k.LOW_RISK),className:"block w-full text-left text-xs bg-yellow-900/20 hover:bg-yellow-900/30 px-2 py-1 rounded",children:"Low Risk (1-10%)"}),e.jsx("button",{onClick:()=>o(k.MODERATE_RISK),className:"block w-full text-left text-xs bg-orange-900/20 hover:bg-orange-900/30 px-2 py-1 rounded",children:"Moderate Risk (10-25%)"}),e.jsx("button",{onClick:()=>o(k.HIGH_RISK),className:"block w-full text-left text-xs bg-red-900/20 hover:bg-red-900/30 px-2 py-1 rounded",children:"High Risk (25-75%)"}),e.jsx("button",{onClick:()=>o(k.CRITICAL_RISK),className:"block w-full text-left text-xs bg-red-800/30 hover:bg-red-800/40 px-2 py-1 rounded animate-pulse",children:"Critical Risk (75%+)"})]}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Demo data shows different dispute bond scenarios for testing UI behavior."})]}),document.body):S.createPortal(e.jsx("div",{className:"fixed top-4 left-4 z-50 text-xs text-muted-foreground bg-background/90 px-2 py-1 rounded",children:"DEV: F2 for demo"}),document.body)):null},P=({animated:t=!0})=>{const[x,o]=s.useState(!1),{gaugeData:a,riskLevel:i,lastUpdated:r,isLoading:l,error:c}=j();return s.useEffect(()=>{const u=D.subscribe(m=>{const f=m.uiState===N.MAIN_CONTENT;o(f)}),d=D.get().uiState===N.MAIN_CONTENT;return o(d),u},[]),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full text-center py-8",children:[l&&e.jsx("div",{className:"mb-4 text-muted-foreground",children:"Loading fork risk data..."}),c&&e.jsxs("div",{className:"mb-4 text-orange-400",children:["Warning: ",c]}),e.jsx(A,{percentage:a.percentage}),e.jsx(K,{riskLevel:i,repStaked:a.repStaked,activeDisputes:a.activeDisputes}),e.jsxs("div",{className:"text-sm font-light tracking-[0.05em] uppercase text-muted-foreground",children:["Last updated: ",e.jsx("span",{children:r})]})]}),e.jsx(V,{})]}):null},B=({animated:t=!0})=>e.jsx(_,{children:e.jsx(U,{children:e.jsx(P,{animated:t})})});export{B as default};
